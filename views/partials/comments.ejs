<style>
  .comment-filter-button.active {
    color: #4edcd8;
  }
  .sort-active {
    background-color: #4edcd8;
    color: white;
    box-shadow: 0px 0px 15px #4edcd8;
  }
</style>
<div>
  <!-- HEADING -->
  <div class="comments">
    <div class="comment-header">
      <h3>Comments</h3>
    </div>
    <div class="comment-button">
      <button
        type="button"
        class="comment-vote-button"
        data-toggle="modal"
        data-target="#commentModal"
        onclick="toggleComment()"
      >
        Vote/Comment
      </button>
    </div>
  </div>

  <!-- FILTER BUTTONS -->
  <div class="comment-filters">
    <form method="get" accept="/" class="all">
      <input
        name="sorting"
        value="<%= sort %>"
        style="display: none"
        class="comment-sort-button recent-sort"
      />
      <% if (button == "all") { %>
      <button class="comment-filter-button active" name="filter" value="all">
        All
      </button>
      <% } else { %>
      <button name="filter" value="all" class="comment-filter-button">
        All
      </button>
      <% } %>
    </form>
    <form class="mbti">
      <input
        name="sorting"
        value="<%= sort %>"
        style="display: none"
        class="comment-sort-button recent-sort"
      />
      <% if (button == "mbti") { %>
      <button class="comment-filter-button active" name="filter" value="mbti">
        MBTI
      </button>
      <% } else { %>
      <button name="filter" value="mbti" class="comment-filter-button">
        MBTI
      </button>
      <% } %>
    </form>
    <form class="enneagram">
      <input
        name="sorting"
        value="<%= sort %>"
        style="display: none"
        class="comment-sort-button recent-sort"
      />
      <% if (button == "Enneagram") { %>
      <button
        class="comment-filter-button active"
        name="filter"
        value="Enneagram"
      >
        Enneagram
      </button>
      <% } else { %>
      <button name="filter" value="Enneagram" class="comment-filter-button">
        Enneagram
      </button>
      <% } %>
    </form>
    <form class="zodiac">
      <input
        name="sorting"
        value="<%= sort %>"
        style="display: none"
        class="comment-sort-button recent-sort"
      />
      <% if (button == "zodiac") { %>
      <button class="comment-filter-button active" name="filter" value="zodiac">
        Zodiac
      </button>
      <% } else { %>
      <button name="filter" value="zodiac" class="comment-filter-button">
        Zodiac
      </button>
      <% } %>
    </form>
  </div>
  <!-- SORT BUTTONS -->
  <div class="comment-sort">
    <form method="get" class="best">
      <input
        name="filter"
        value="<%= button %>"
        style="display: none"
        class="comment-sort-button recent-sort"
      />
      <% if (sort == "best") { %>
      <button
        name="sorting"
        value="best"
        class="comment-sort-button best-sort sort-active"
      >
        best
      </button>
      <% } else { %>
      <button name="sorting" value="best" class="comment-sort-button best-sort">
        best
      </button>
      <% } %>
    </form>
    <form method="get" action="/" class="recent">
      <input
        name="filter"
        value="<%= button %>"
        style="display: none"
        class="comment-sort-button recent-sort"
      />
      <% if (sort == "recent") { %>
      <button
        name="sorting"
        value="recent"
        class="comment-sort-button recent-sort sort-active"
      >
        recent
      </button>
      <% } else { %>
      <button
        name="sorting"
        value="recent"
        class="comment-sort-button recent-sort"
      >
        recent
      </button>
      <% } %>
    </form>
  </div>
  <!-- COMMENT CARDS -->
  <div class="comment-main">
    <!-- ADD COMMENT -->
    <div class="comment-card add">
      <div class="add-comment">
        <div class="comment-header">
          <div class="user-profile-image">
            <img
              class="profile-image"
              src="http://esq.h-cdn.co/assets/17/10/1280x1280/square-1488906206-daniel-craig.jpg"
              alt="user profile image"
            />
          </div>
          <div class="user-name">
            <h5 id="user-name">James</h5>
          </div>
        </div>
        <form action="/post" method="post">
          <div class="comment-body">
            <div class="comment-title">
              <input name="title" class="title-input" placeholder="Title" />
            </div>
            <div class="voting">
              <select id="voting-mbti" class="voting-mbti" name="mbti">
                <option value="" selected>MBTI</option>
                <option style="background: #4edcd8" value="INFP">INFP</option>
                <option value="INFJ">INFJ</option>
                <option value="ENFP">ENFP</option>
                <option value="INTJ">INTJ</option>
                <option value="INTP">INTP</option>
                <option value="ENTP">ENTP</option>
                <option value="ENTJ">ENTJ</option>
                <option value="ISFP">ISFP</option>
                <option value="ISFJ">ISFJ</option>
                <option value="ESFP">ESFP</option>
                <option value="ESFJ">ESFJ</option>
                <option value="ISTP">ISTP</option>
                <option value="ISTJ">ISTJ</option>
                <option value="ESTP">ESTP</option>
                <option value="ESTJ">ESTJ</option>
              </select>
              <select class="voting-enneagram" name="Enneagram">
                <option style="background: #13a6a2" value="" selected>
                  Enneagram
                </option>
                <option
                  style="background: url(../../public/static/wing.png)"
                  value="1w2"
                >
                  1w2
                </option>
                <option
                  style="background: url(../../public/static/wing.png)"
                  value="2w3"
                >
                  2w3
                </option>
                <option value="3w2">3w2</option>
                <option value="3w4">3w4</option>
                <option value="4w3">4w3</option>
                <option value="4w5">4w5</option>
                <option value="5w4">5w4</option>
                <option value="5w6">5w6</option>
                <option value="6w5">6w5</option>
                <option value="6w7">6w7</option>
                <option value="7w6">7w6</option>
                <option value="7w8">7w8</option>
                <option value="8w7">8w7</option>
                <option value="8w9">8w9</option>
                <option value="9w8">9w8</option>
                <option value="9w1">9w1</option>
              </select>
              <select class="voting-zodiac" name="Zodiac">
                <option style="background: #000" value="" selected>
                  Zodiac
                </option>
                <option value="Aries">Aries</option>
                <option value="Taurus">Taurus</option>
                <option value="Gemini">Gemini</option>
                <option value="Cancer">Cancer</option>
                <option value="Leo">Leo</option>
                <option value="Virgo">Virgo</option>
                <option value="Libra">Libra</option>
                <option value="Scorpio">Scorpio</option>
                <option value="Sagittarius">Sagittarius</option>
                <option value="Capricorn">Capricorn</option>
                <option value="Aquarius">Aquarius</option>
                <option value="Pisces">Pisces</option>
              </select>
            </div>
            <div class="comment-text">
              <textarea
                id="comment-input"
                class="comment-input"
                style="overflow: hidden"
                placeholder="Share your thoughts by commenting here"
                name="comment"
              ></textarea>
            </div>
            <div class="comment-button">
              <button onclick="handleSubmit()" class="comment-submit-button">
                <span class="material-icons"> send </span>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <!-- DISPLAY COMMENTS FROM COMMENT DATA ARRAY -->
  <div class="comment-section">
    <% for (let i = 0; i < commentData.length; i++) { %>
    <div class="comment-card">
      <div class="comment">
        <div class="comment-header">
          <div class="user-profile-image">
            <img
              class="profile-image"
              src="http://esq.h-cdn.co/assets/17/10/1280x1280/square-1488906206-daniel-craig.jpg"
              alt="user profile image"
            />
          </div>
          <div class="user-name">
            <h5 id="user-name"><%= commentData[i].name %></h5>
          </div>
        </div>
        <div class="comment-body">
          <div class="comment-title">
            <h5><%= commentData[i].title %></h5>
          </div>
          <div class="voting">
            <% if (commentData[i].mbti) { %>

            <button style="opacity: 100%" class="voting-mbti">
              <%= commentData[i].mbti %>
            </button>

            <% } %> <% if (commentData[i].enneagram) { %>

            <button style="opacity: 100%" class="voting-enneagram">
              <%= commentData[i].enneagram %>
            </button>

            <% } %> <% if (commentData[i].zodiac) { %>

            <button style="opacity: 100%" class="voting-zodiac">
              <%= commentData[i].zodiac %>
            </button>

            <% } %>
          </div>
          <div class="comment-text">
            <p><%= commentData[i].comment %></p>
          </div>
          <div class="heart-like">
            <button class="heart-like-button">
              <span class="material-icons"> favorite </span>
            </button>
            <span class="number-of-likes">
              <p><%= commentData[i].likes %></p>
            </span>
          </div>
        </div>
      </div>
    </div>
    <% } %>
  </div>

  <script type="text/javascript">
    function toggleComment() {
      //toggel comment section
      let main = document.querySelector(".comment-main");
      main.classList.toggle("ds-none");
    }

    function handleSubmit() {
      //on submit the borders should glow #4edcd8 for 1 second
      let commentInput = document.querySelector(".add");
      commentInput.classList.add("glow-card");
      setTimeout(() => {
        commentInput.classList.remove("glow-card");
      }, 1000);

      //make the opacity of the mbti enneagram and zodiac button in input fields 30%
      document.querySelector("#voting-mbti").style.opacity = "30%";
      document.querySelector(".voting-enneagram").style.opacity = "30%";
      document.querySelector(".voting-zodiac").style.opacity = "30%";
      handleSendButton();
    }
    //make voting item visible when value is chosen
    let mbti = document.querySelector(".voting-mbti");
    let enneagram = document.querySelector(".voting-enneagram");
    let zodiac = document.querySelector(".voting-zodiac");

    //update the opacity on change of the select option
    mbti.addEventListener("change", function () {
      if (mbti.value != "") {
        mbti.style.opacity = "100%";
      }
    });
    enneagram.addEventListener("change", function () {
      if (enneagram.value != "") {
        enneagram.style.opacity = "100%";
      }
    });
    zodiac.addEventListener("change", function () {
      if (zodiac.value != "") {
        zodiac.style.opacity = "100%";
      }
    });

    function handleSendButton() {
      //comment-submit-button turns #4edcd8 when user selects  either mbti, enneagram, or zodiac or when user types in title or comment input field and turns back to #e0e0e0 when user deselects mbti, enneagram, or zodiac or when user deletes title or comment input field & is disabled when user does not select mbti, enneagram, or zodiac and does not type in title or comment input field
      let commentSubmitButton = document.querySelector(
        ".comment-submit-button"
      );
      let commentInput = document.querySelector("#comment-input");
      let titleInput = document.querySelector(".title-input");
      let mbtiInput = document.querySelector("#voting-mbti");
      let enneagramInput = document.querySelector(".voting-enneagram");
      let zodiacInput = document.querySelector(".voting-zodiac");
      if (
        mbtiInput.value != "" ||
        enneagramInput.value != "" ||
        zodiacInput.value != "" ||
        commentInput.value != "" ||
        titleInput.value != ""
      ) {
        commentSubmitButton.style.color = "#4edcd8";
        commentSubmitButton.disabled = false;
      } else {
        commentSubmitButton.style.color = "#e0e0e0";
        commentSubmitButton.disabled = true;
      }
      commentInput.addEventListener("input", function () {
        if (
          mbtiInput.value != "" ||
          enneagramInput.value != "" ||
          zodiacInput.value != "" ||
          commentInput.value != "" ||
          titleInput.value != ""
        ) {
          commentSubmitButton.style.color = "#4edcd8";
          commentSubmitButton.disabled = false;
        } else {
          commentSubmitButton.style.color = "#e0e0e0";
          commentSubmitButton.disabled = true;
        }
      });
      titleInput.addEventListener("input", function () {
        if (
          mbtiInput.value != "" ||
          enneagramInput.value != "" ||
          zodiacInput.value != "" ||
          commentInput.value != "" ||
          titleInput.value != ""
        ) {
          commentSubmitButton.style.color = "#4edcd8";
          commentSubmitButton.disabled = false;
        } else {
          commentSubmitButton.style.color = "#e0e0e0";
          commentSubmitButton.disabled = true;
        }
      });
      mbtiInput.addEventListener("change", function () {
        if (
          mbtiInput.value != "" ||
          enneagramInput.value != "" ||
          zodiacInput.value != "" ||
          commentInput.value != "" ||
          titleInput.value != ""
        ) {
          commentSubmitButton.style.color = "#4edcd8";
          commentSubmitButton.disabled = false;
        } else {
          commentSubmitButton.style.color = "#e0e0e0";
          commentSubmitButton.disabled = true;
        }
      });
      enneagramInput.addEventListener("change", function () {
        if (
          mbtiInput.value != "" ||
          enneagramInput.value != "" ||
          zodiacInput.value != "" ||
          commentInput.value != "" ||
          titleInput.value != ""
        ) {
          commentSubmitButton.style.color = "#4edcd8";
          commentSubmitButton.disabled = false;
        } else {
          commentSubmitButton.style.color = "#e0e0e0";
          commentSubmitButton.disabled = true;
        }
      });
      zodiacInput.addEventListener("change", function () {
        if (
          mbtiInput.value != "" ||
          enneagramInput.value != "" ||
          zodiacInput.value != "" ||
          commentInput.value != "" ||
          titleInput.value != ""
        ) {
          commentSubmitButton.style.color = "#4edcd8";
          commentSubmitButton.disabled = false;
        } else {
          commentSubmitButton.style.color = "#e0e0e0";
          commentSubmitButton.disabled = true;
        }
      });
    }
    handleSendButton();

    //toggel like button color when clicked and add 1 to like count when clicked and remove 1 from like count when clicked again.
    let likeButton = document.querySelectorAll(".heart-like-button");
    likeButton.forEach((button) => {
      button.addEventListener("click", function () {
        if (button.style.color == "rgb(78, 220, 216)") {
          button.style.color = "#6b6a6a";
        } else {
          button.style.color = "#4edcd8";
        }
      });
    });
  </script>
</div>
